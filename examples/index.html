<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>d3.relationshipgraph Example</title>

    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="../src/d3-tip.js"></script>
    <script src="../src/index.js"></script>
    <link type="text/css" rel="stylesheet" href="../dest/d3.relationshipgraph.min.css">
</head>
<body>
<h1 style="text-align: center; font-family: Helvetica, sans-serif; color: #323232">Objects in packages
</h1>
<div id="graph" style="width: 300px; margin: 20px auto;">
</div>
<div style="width: 300px; margin:0 auto;">
    <button onclick="data1()">Data Set 1</button>
    <button onclick="random()">Random Data</button>
</div>
<br/>
<div style="text-align: center; font-size: 10pt; font-family: Helvetica, sans-serif;">
    Objects in packages
</div>
<script>
    var json1 = [
        {
            "Object": "Sym1",
    "parent": "ttf.o",
    "value": 0
        },
        {
            "Object": "Sym2",
    "parent": "ttf.o",
    "value": 0
        },
        {
            "Object": "Sym3",
    "parent": "ttf.o",
    "value": 0
        },
        {
            "Object": "Sym1",
                "parent": "alx.o",
    "value": 0
    },
        {
            "Object": "Sym2",
                "parent": "alx.o",
    "value": 1
    },
        {
            "Object": "Sym3",
                "parent": "alx.o",
    "value": 2
    },
    ];


    function nodeDrawCallback(_this, thing)
    {
    thing.append('rect')
                .attr('x', function(obj) {
                    return 32 + ((obj.index - 1) * _this.config.blockSize);
                })
                .attr('y', function(obj) {
                    return (obj.row - 1) * _this.config.blockSize;
                })
                .attr('rx', 8)
                .attr('ry', 8)
                .attr('class', 'relationshipGraph-block')
                .attr('width', _this.config.blockSize)
                .attr('height', _this.config.blockSize)
                .style('fill', function(obj) {
                    return _this.config.colors[obj.color % _this.config.colors.length] || _this.config.colors[0];
                })
                .on('mouseover', _this.tip ? _this.tip.show : noop)
                .on('mouseout', _this.tip ? _this.tip.hide : noop)
                .on('click', function(obj) {
                    _this.tip.hide();
                    _this.config.onClick(obj);
    });
    }

    var graph = d3.select('#graph').relationshipGraph({
        'showTooltips': true,
        'maxChildCount': 2,
    'showKeys': false,
    'blockSize': 32,
    'nodeDrawCallback': nodeDrawCallback,
    'thresholds': [1, 2, 3], // This is the threshold used for each colour
    onClick: function(obj) { // This is called when a symbol is clicked
    },
    colors: ['red', 'green', 'blue'],
    });

    graph.data(json1);

    var interval = null;

    function data1() {
        if (interval != null) {
            clearInterval(interval);
        }
        graph.data(json1);
        document.querySelector('h1').innerHTML = 'Package View';
    }

    function random() {
        var getData = function () {
            var json = [];

            for (var j = 0; j < 35; j++) {
                var obj = {
                    'parent': 'parent' + Math.floor(Math.random() * 6),
                    'value': 1000000000 * Math.floor(Math.random() * 3)
                };

                json.push(obj);
            }

            graph.data(json);
        };

        getData();

        if (interval === null) {
            interval = setInterval(getData, 1000);
        }

        document.querySelector('h1').innerHTML = 'Random Data';
    }

</script>
</body>
</html>
